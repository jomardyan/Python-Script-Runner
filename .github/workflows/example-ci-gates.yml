name: Example - CI Performance Gates

on:
  pull_request:
    paths:
      - '**.py'
      - '.github/workflows/example-ci-gates.yml'
  push:
    branches:
      - main
    paths:
      - '**.py'

jobs:
  performance-tests:
    runs-on: ubuntu-latest
    name: Performance Benchmarks
    
    steps:
      - name: 'Checkout code'
        uses: actions/checkout@v3

      - name: 'Run performance benchmark'
        uses: ./.github/actions/python-script-runner
        with:
          script-path: './tests/performance_benchmark.py'
          python-version: '3.11'
          timeout-minutes: 30
          max-retries: 1
          fail-fast: true
          upload-metrics: 'https://benchmarks.example.com/api'

  security-scan:
    runs-on: ubuntu-latest
    name: Security Scanning
    
    steps:
      - name: 'Checkout code'
        uses: actions/checkout@v3

      - name: 'Run security scan'
        uses: ./.github/actions/python-script-runner
        with:
          script-path: './scripts/security_check.py'
          python-version: '3.11'
          enable-security-scan: true
          enable-dependency-scan: true
          fail-fast: true
